version: '3.9'

services:
  # ---------------------------------------------------------------------------
  # SERVIZIO 1: Sidecar Rust
  # ---------------------------------------------------------------------------
  bgutil-sidecar:
    image: ghcr.io/jim60105/bgutil-pot:latest
    container_name: bgutil-sidecar
    restart: unless-stopped
    environment:
      - RUST_LOG=info
      - SERVER_PORT=4416

  # ---------------------------------------------------------------------------
  # SERVIZIO 2: MusicBot (SCARICATO DA GHCR)
  # ---------------------------------------------------------------------------
  musicbot:
    container_name: musicbot
    #  vvvvvvvvv MODIFICA IMPORTANTE vvvvvvvvv
    # Sostituisci 'gabrieleligetta' col tuo username GitHub esatto (tutto minuscolo)
    image: ghcr.io/gabrieleligetta/musicbot:latest
    #  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    # RIMUOVI LA RIGA: build: .
    restart: unless-stopped
    
    network_mode: service:bgutil-sidecar
    depends_on:
      - bgutil-sidecar
        
    env_file:
      - .env
    environment:
      - YTDL_OPTIONS=--extractor-args "youtube:player_client=default,mweb;po_token=web+http://127.0.0.1:4416/get_pot"
    volumes:
      - ./database.sqlite:/usr/src/app/database.sqlite
      - ./Playlists:/usr/src/app/Playlists
      - ./cookies.json:/usr/src/app/cookies.json
